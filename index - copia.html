<!DOCTYPE html>
<html>
<head>
<title>Proyecto MJSF</title>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>

    <style>
      #map {
        height: 500px;
        width: 100%;
       }
    </style>
</head>
<body>

  <!--////////////////////////////////////////////Menu desplegable//////////////////////////////////////////////////-->
  <h3>Escoge rango</h3>
  <form>


      <select id= "anio" name="anio">
      <option selected value="0"> año </option>
      <script type="text/javascript">
      for (x=0; x<7; x++){
        document.write("<option value="+(x+2018)+">"+ (x+2018)+ "</option>");
        //document.getElementById("anio");
      }
      </script>
    </select>


      <select id= "mes1" name="mes1">
      <option selected value="0"> mes </option>
      <option value="01"> 01 </option>
      <option value="02"> 02 </option>
      <option value="03"> 03 </option>
      <option value="04"> 04 </option>
      <option value="05"> 05 </option>
      <option value="06"> 06 </option>
      <option value="07"> 07 </option>
      <option value="08"> 08 </option>
      <option value="09"> 09 </option>
      <option value="10"> 10 </option>
      <option value="11"> 11 </option>
      <option value="12"> 12 </option>

      <!-- <script type="text/javascript">
      for (x=0; x<12; x++){
        document.write("<option>"+ parseInt(x+1)+ "</option>");
      } -->
<!--     </script> -->
    </select>


    <select id= "dia1" name="dia1">
      <option selected value="0"> dia </option>
      <script type="text/javascript">
      for (x=0; x<31; x++){
        document.write("<option value="+(x+1)+">"+ (x+1)+ "</option>"); 
      }
      </script>
    </select>


    <select id= "hora1" name="hora1">
      <option selected value="0"> Hora </option>
      <script type="text/javascript">
      for (x=0; x<23; x++){
        document.write("<option value="+(x+1)+">"+ (x+1)+ "</option>");
      }

      </script>

    </select>

  </form>

    <p> </p>
    <button onclick="generateSTcode()">Enviar</button>
    <p id="demo"></p>
  <script>

      var mesgvalue = "0"
      var diagvalue = "0"
      var anogvalue = "0"
      var hoaragvalue = "0"
      Bandera = 0


      function generateSTcode() {

         Bandera=1;

        //document.getElementById("demo").innerHTML = "porfinnnnnnnnnnn"

        var mesg =document.getElementById('mes1');
        mesgvalue=mesg.value;

        var diag =document.getElementById('dia1');
        diagvalue=diag.value;

        var anog =document.getElementById('anio');
        anogvalue=anog.value;

        var horag =document.getElementById('hora1');
        hoaragvalue=horag.value;

        initMap(Bandera, mesgvalue, diagvalue, anogvalue, hoaragvalue);

        // var longElement = document.getElementById("test"); // Voy a mostrar un texto en donde esté el id "Latitud"
        // longElement.textContent =  "SIIIII: "+mesgvalue;

      }

      //function a(){
        //var longElement = document.getElementById("test"); // Voy a mostrar un texto en donde esté el id "Latitud"
        //longElement.textContent =  "SIIIII: "+mesgvalue;
      //}

    </script>

<!--///////////////////////////////////////////////////////////////////////////////////////////////-->


  
    <div id="map"></div>
    <script>

      function initMap() {

        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 13,
          center: {lat:11.0041 , lng:-74.8070}
        });
        var SigLag={}
        var SigLong={}

        var marker = new google.maps.Marker({ });

        getter(Bandera, mesgvalue, diagvalue, anogvalue, hoaragvalue);

        setInterval(getter,7000);
      

        function getter(){

          /////////////////////////////////////////////////////////////////pocicion actal en el mapa/////////////////////////////////////////////////////////////////
          var infodb2 = function () {  
            var temporal2 = null;
           $.ajax({
              'async': false,
              'type': "POST",
              'global': false,
              'dataType': 'html',
              'url': "get2.php",
              'success': function (data2) {
                  temporal2 = data2;
              }
          });
          return temporal2;
      }();

      if (infodb2==null) {
        infodb2="";

      }

        //var longElement = document.getElementById("test"); // Voy a mostrar un texto en donde estén los valores de las barras de seleccion
        //longElement.textContent =  "Valores: "+Bandera+" "+mesgvalue+" "+diagvalue+" "+anogvalue+" "+hoaragvalue;

        var longElement2 = document.getElementById("test"); // Voy a mostrar un texto en donde esté el id "Latitud"

        var data2=infodb2.split("\n")

        //longElement2.textContent =  "ID: "+data2[1];
       longElement2.textContent =  "ID: "+data2[0]+" Latitud: "+data2[1]+" Latitud: "+data2[2]+" Fecha: "+data2[3]+"/"+data2[4]+"/"+data2[5]+" Hora: "+data2[6]+":"+data2[7]+":"+data2[8]+" Dia: "+data2[9];

       var uluru = {lat: Number(data2[1]), lng: Number(data2[2])};

       marker.setMap(null);
        marker = new google.maps.Marker({
          position: uluru,
          map: map,
          title:'Holi'
        });

        ///////////////////////////////////////////////////////Atencion a historicos y trazado de rutas (Polyline)///////////////////////////////////////////////////////

        if (Bandera==1) {

          Bandera=0;
         
        var infodb = function () {  
            var temporal = null;
           $.ajax({
              'async': false,
              'type': "POST",
              'global': false,
              'dataType': 'html',
              'url': "get.php",
              'success': function (data) {
                  temporal = data;
              }
          });
          return temporal;
      }();

      if (infodb==null) {
        infodb="";

      }

      var data=infodb.split("\n") //de data[1] hasta data[10], de 11 hasta 20, de 21 hasta 30 (payload) .........  DATA 0 REPRESENTA EN # DE DATOS EN TABLA 

      // longElement.textContent =  "Latitud: "+data[0]+" Longitud: "+data[1]+" Fecha y Hora: "+data[2];

      //longElement.textContent =  "Base de datos: "+data;     

      var control=Number(data[0]);

        //ano es el numero 6, mes el 5, dia el 4, long el 3, lat el 2, hora el 7

        if (anogvalue=="0"){
        document.getElementById("demo").innerHTML = "Debes seleccionar algun año"
        }

        if ((anogvalue!="0") && (mesgvalue!="0") && (diagvalue=="0") && (hoaragvalue!="0")){
          document.getElementById("demo").innerHTML = "Debes seleccionar algun dia"
        }

        if ((anogvalue!="0") && (mesgvalue=="0") && (diagvalue!="0")){
          document.getElementById("demo").innerHTML = "Debes seleccionar algun mes"
        }

        if ((anogvalue!="0") && (mesgvalue=="0") && (diagvalue=="0") && (hoaragvalue!="0")){
          document.getElementById("demo").innerHTML = "Debes seleccionar algun mes y dia"
        }

        if ((anogvalue!="0") && (mesgvalue!="0") && (diagvalue!="0") && (hoaragvalue!="0")){
          document.getElementById("demo").innerHTML = ""

          for (x=0; x<(control-1); x++){
            if ((anogvalue == data[(6+(10*x))]) && (mesgvalue == data[(5+(10*x))]) && (diagvalue == data[(4+(10*x))]) && (hoaragvalue == data[(7+(10*x))])){

              var AntLa = SigLag
              var AntLong = SigLong
              SigLag = Number(data[(2+(10*x))])
              SigLong = Number(data[(3+(10*x))])
              var flightPlanCoordinates = [
              {lat: AntLa, lng: AntLong},
              {lat: SigLag, lng: SigLong},
              ];

              var flightPath = new google.maps.Polyline({
              path: flightPlanCoordinates,
              geodesic: true,
              strokeColor: '#FF0000',
              strokeOpacity: 1.0,
              strokeWeight: 2
              });

              flightPath.setMap(map);

            }
          }
        }

        if ((anogvalue!="0") && (mesgvalue!="0") && (diagvalue!="0") && (hoaragvalue=="0")){
          document.getElementById("demo").innerHTML = ""

          for (x=0; x<(control-1); x++){
            if ((anogvalue == data[(6+(10*x))]) && (mesgvalue == data[(5+(10*x))]) && (diagvalue == data[(4+(10*x))])){

              var AntLa = SigLag
              var AntLong = SigLong
              SigLag = Number(data[(2+(10*x))])
              SigLong = Number(data[(3+(10*x))])
              var flightPlanCoordinates = [
              {lat: AntLa, lng: AntLong},
              {lat: SigLag, lng: SigLong},
              ];

              var flightPath = new google.maps.Polyline({
              path: flightPlanCoordinates,
              geodesic: true,
              strokeColor: '#FF0000',
              strokeOpacity: 1.0,
              strokeWeight: 2
              });

              flightPath.setMap(map);

            }
          }
        }

        if ((anogvalue!="0") && (mesgvalue!="0") && (diagvalue=="0") && (hoaragvalue=="0")){
          document.getElementById("demo").innerHTML = ""

          for (x=0; x<(control-1); x++){
            if ((anogvalue == data[(6+(10*x))]) && (mesgvalue == data[(5+(10*x))])){

              var AntLa = SigLag
              var AntLong = SigLong
              SigLag = Number(data[(2+(10*x))])
              SigLong = Number(data[(3+(10*x))])
              var flightPlanCoordinates = [
              {lat: AntLa, lng: AntLong},
              {lat: SigLag, lng: SigLong},
              ];

              var flightPath = new google.maps.Polyline({
              path: flightPlanCoordinates,
              geodesic: true,
              strokeColor: '#FF0000',
              strokeOpacity: 1.0,
              strokeWeight: 2
              });

              flightPath.setMap(map);

            }
          }
        }

        if ((anogvalue!="0") && (mesgvalue=="0") && (diagvalue=="0") && (hoaragvalue=="0")){
          document.getElementById("demo").innerHTML = ""

          for (x=0; x<(control-1); x++){
            if (anogvalue == data[(6+(10*x))]){

              var AntLa = SigLag
              var AntLong = SigLong
              SigLag = Number(data[(2+(10*x))])
              SigLong = Number(data[(3+(10*x))])
              var flightPlanCoordinates = [
              {lat: AntLa, lng: AntLong},
              {lat: SigLag, lng: SigLong},
              ];

              var flightPath = new google.maps.Polyline({
              path: flightPlanCoordinates,
              geodesic: true,
              strokeColor: '#FF0000',
              strokeOpacity: 1.0,
              strokeWeight: 2
              });

              flightPath.setMap(map);

            }
          }
        }
      }
      }
    }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBOaRqI8IcgcQlXj5Evtv-0KgcHccWbeM&callback=initMap">
    </script>

<h1 id="test"></h1>
<p ></p>

</body>
</html>